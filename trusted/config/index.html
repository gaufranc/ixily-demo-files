<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>oAuth / Config</title>

    <!-- Importing the IXily widget .js file -->
    <script src="https://ixily.io/assets/js/ixily-widget.min.js"></script>
</head>
<body>
    <h4>
        Step one - Simple basic embed of the widget and client configuration
    </h4>

    <p>The permission/user workflow differs depending on the user data that is provideded. The use cases include:</p>

    <p>The easiest way to test the different use cases is to change the user object that's passed.  Note that if you connect a user profile, you'll need to disconnect it before you can connect it again i.e. connecting an already connected profile is a different use case.</p>

    <p>All cases assume that the user is registered and authenticated in your application.</p>

    <ul>
        <li>User exists in IXily and is authenticated (on IXily) -> grants permission</li>
        <li>User exists in IXily but is not authenticated (on IXily) -> must authenticate -> grants permission</li>
        <li>User does not exist in IXily -> click to create profile (permission granted)</li>
    </ul>

    <p>Note the if there is a conflict between authenticated users (very likely to happen in development), the user is asked to re-authenticate. This may mean you are asked to re-authenticate more often that in reality.</p>

    <h3>Unlinking YOUR user</h3>

    <p>If you have connected your user profile, open the Trade Order Widget via ixily.io, select Connections from the left menu and remove the appropriate connection.</p>

    <div id="widget-oauth-basic"></div>
    
    <!-- JS Script to use the imported .js file and launch the button -->
    <script type="text/javascript">

        // Declare a normal function
        function createWidgetOAuth(){

            // Init
            let widget;
            widget = new IXilyWidget('');

            // Width/height of the iframe, not the buttons.
            const width = '180px';
            const height = '45px';
            
            // Client ID of the oAuthApp
            const oAuthClientID = '035ae6824fa5ee0dc68e'

            // Data to encrypt
            let dataoAuthIxily = {
                reference: "328d7153-26e4-4ad8-a029-3935e138fd9d",
                first_name: "Conor",
                last_name: "Naylor",
                email: "conor@aikido.finance",
                client_id: "035ae6824fa5ee0dc68e",
                partner_name: "Aikido",
            };

            dataoAuthIxily = JSON.stringify(dataoAuthIxily);


            // This is useful for them to access the stringified object and paste it in the next stackblitz (to encrypt)
            console.log('------------');
            console.log('Stringified object to paste in the encryption site: ', dataoAuthIxily);
            console.log('------------');

            // Now we encrypt the stringified object with CryptoJS AES encryption, using the oAuthApp secret. I used this web as sample: https://stackblitz.com/edit/cryptojs-aes-encrypt-decrypt
            // Secret of Aikido oAuth App = d3a745e0c3294c90f24b6025c3c78ec4bc860f4c (to use in the stackblitz as Key)
            encryptedData = 'U2FsdGVkX1+u30/XY3egQPNWO4cuu50SDrP/V5w/8si0RItJTNqk5ehxpJfjbMN2keug5g4cZEFBOC/07TBH38eNoxY1hkKzJwRcpXnFPuL5FUqMgKD75PShfwyQsMXP3P2+MisZJ2vghaOLSrkCrbVynTjf4nfRzIWO2Bah2V9SI+zRl/k4WNcN5bR5RkFwtyprxodQ6dKjVX6V4i3NisV84UXkMHDQrgqEMkAt1nxeuJHTa8BtKR2PfmH9q846YZUJ6/FyouML1sK6U+iSfw=='


            // Settings of the widget
            const widgetOrderSettings = {
                payload: {
                    option: 'place_order',
                    data: {
                        firstDisplay: 'oauth_link',
                        oAuthClientID,
                        oAuthEncryptedIXilyData: encryptedData,
                    },
                },
                styles: {
                    width,
                    height,
                },
                origin: window.location.origin || null,
            };
            widget.createWidget('widget-oauth-basic', widgetOrderSettings);
        }

        createWidgetOAuth();
    </script>
</body>
</html>